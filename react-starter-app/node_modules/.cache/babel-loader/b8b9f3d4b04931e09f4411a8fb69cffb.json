{"ast":null,"code":"/**\n * Copyright (c) 2021\n *\n * Embed ThoughtSpot search or a saved answer\n *\n * @summary Search embed\n * @author Ayon Ghosh <ayon.ghosh@thoughtspot.com>\n */\nimport { DataSourceVisualMode, Param } from '../types';\nimport { getQueryParamString } from '../utils';\nimport { TsEmbed } from './ts-embed';\n/**\n * Embed ThoughtSpot search\n *\n * @Category Search Embed\n */\n\nexport class SearchEmbed extends TsEmbed {\n  constructor(domSelector, viewConfig) {\n    super(domSelector);\n    this.viewConfig = viewConfig;\n  }\n  /**\n   * Get the state of the data sources panel that the embedded\n   * ThoughtSpot search will be initialized with.\n   */\n\n\n  getDataSourceMode() {\n    let dataSourceMode = DataSourceVisualMode.Expanded;\n\n    if (this.viewConfig.collapseDataSources === true) {\n      dataSourceMode = DataSourceVisualMode.Collapsed;\n    }\n\n    if (this.viewConfig.hideDataSources === true) {\n      dataSourceMode = DataSourceVisualMode.Hidden;\n    }\n\n    return dataSourceMode;\n  }\n  /**\n   * Construct the URL of the embedded ThoughtSpot search to be\n   * loaded in the iframe\n   * @param answerId The GUID of a saved answer\n   * @param dataSources A list of data source GUIDs\n   */\n\n\n  getIFrameSrc(answerId, dataSources) {\n    const {\n      hideResults,\n      expandAllDataSource,\n      enableSearchAssist,\n      forceTable,\n      searchOptions\n    } = this.viewConfig;\n    const answerPath = answerId ? `saved-answer/${answerId}` : 'answer';\n    const queryParams = this.getBaseQueryParams();\n\n    if (dataSources && dataSources.length) {\n      queryParams[Param.DataSources] = JSON.stringify(dataSources);\n    }\n\n    if (searchOptions === null || searchOptions === void 0 ? void 0 : searchOptions.searchTokenString) {\n      queryParams[Param.searchTokenString] = encodeURIComponent(searchOptions.searchTokenString);\n\n      if (searchOptions.executeSearch) {\n        queryParams[Param.executeSearch] = true;\n      }\n    }\n\n    if (enableSearchAssist) {\n      queryParams[Param.EnableSearchAssist] = true;\n    }\n\n    if (hideResults) {\n      queryParams[Param.HideResult] = true;\n    }\n\n    if (forceTable) {\n      queryParams[Param.ForceTable] = true;\n    }\n\n    queryParams[Param.DataSourceMode] = this.getDataSourceMode();\n    queryParams[Param.UseLastSelectedDataSource] = false;\n    let query = '';\n    const queryParamsString = getQueryParamString(queryParams, true);\n\n    if (queryParamsString) {\n      query = `?${queryParamsString}`;\n    }\n\n    return `${this.getEmbedBasePath(query)}/${answerPath}`;\n  }\n  /**\n   * Render the embedded ThoughtSpot search\n   */\n\n\n  render() {\n    super.render();\n    const {\n      answerId,\n      dataSources\n    } = this.viewConfig;\n    const src = this.getIFrameSrc(answerId, dataSources);\n    this.renderIFrame(src, this.viewConfig.frameParams);\n    return this;\n  }\n\n}","map":{"version":3,"sources":["/Users/quinton.wall/code/thoughtspot-repo/quickstarts/react-starter-app/node_modules/@thoughtspot/visual-embed-sdk/src/embed/search.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2021\n *\n * Embed ThoughtSpot search or a saved answer\n *\n * @summary Search embed\n * @author Ayon Ghosh <ayon.ghosh@thoughtspot.com>\n */\n\nimport { DataSourceVisualMode, DOMSelector, Param } from '../types';\nimport { getQueryParamString } from '../utils';\nimport { ViewConfig, TsEmbed } from './ts-embed';\nimport { version } from '../../package.json';\n\n/**\n * Configuration for search options\n */\ninterface SearchOptions {\n    /**\n     * The tml string to load the answer\n     */\n    searchTokenString: string;\n    /**\n     * Boolean to determine if the search should be executed or not.\n     * if it is executed, put the focus on the results.\n     * if itâ€™s not executed, put the focus in the search bar - at the end of the tokens\n     */\n    executeSearch?: boolean;\n}\n\n/**\n * The configuration attributes for the embedded search view.\n *\n * @Category Search Embed\n */\nexport interface SearchViewConfig extends ViewConfig {\n    /**\n     * If set to true, the data sources panel is collapsed on load,\n     * but can be expanded manually.\n     */\n    collapseDataSources?: boolean;\n    /**\n     * If set to true, hides the data sources panel.\n     */\n    hideDataSources?: boolean;\n    /**\n     * If set to true, hides the charts and tables in search answers.\n     * This attribute can be used to create a custom visualization\n     * using raw answer data.\n     */\n    hideResults?: boolean;\n    /**\n     * If set to true, expands all the data sources panel.\n     */\n    expandAllDataSource?: boolean;\n    /**\n     * If set to true, the Search Assist feature is enabled.\n     */\n    enableSearchAssist?: boolean;\n    /**\n     * If set to true, the tabular view is set as the default\n     * format for presenting search data.\n     */\n    forceTable?: boolean;\n    /**\n     * The array of data source GUIDs to set on load.\n     */\n    dataSources?: string[];\n    /**\n     * The initial search query to load the answer with.\n     * @deprecated Use {@link searchOptions} instead\n     */\n    searchQuery?: string;\n    /**\n     * Configuration for search options\n     */\n    searchOptions?: SearchOptions;\n    /**\n     * The GUID of a saved answer to load initially.\n     */\n    answerId?: string;\n}\n\n/**\n * Embed ThoughtSpot search\n *\n * @Category Search Embed\n */\nexport class SearchEmbed extends TsEmbed {\n    /**\n     * The view configuration for the embedded ThoughtSpot search.\n     */\n    protected viewConfig: SearchViewConfig;\n\n    constructor(domSelector: DOMSelector, viewConfig: SearchViewConfig) {\n        super(domSelector);\n        this.viewConfig = viewConfig;\n    }\n\n    /**\n     * Get the state of the data sources panel that the embedded\n     * ThoughtSpot search will be initialized with.\n     */\n    private getDataSourceMode() {\n        let dataSourceMode = DataSourceVisualMode.Expanded;\n        if (this.viewConfig.collapseDataSources === true) {\n            dataSourceMode = DataSourceVisualMode.Collapsed;\n        }\n        if (this.viewConfig.hideDataSources === true) {\n            dataSourceMode = DataSourceVisualMode.Hidden;\n        }\n\n        return dataSourceMode;\n    }\n\n    /**\n     * Construct the URL of the embedded ThoughtSpot search to be\n     * loaded in the iframe\n     * @param answerId The GUID of a saved answer\n     * @param dataSources A list of data source GUIDs\n     */\n    private getIFrameSrc(answerId: string, dataSources?: string[]) {\n        const {\n            hideResults,\n            expandAllDataSource,\n            enableSearchAssist,\n            forceTable,\n            searchOptions,\n        } = this.viewConfig;\n        const answerPath = answerId ? `saved-answer/${answerId}` : 'answer';\n        const queryParams = this.getBaseQueryParams();\n        if (dataSources && dataSources.length) {\n            queryParams[Param.DataSources] = JSON.stringify(dataSources);\n        }\n        if (searchOptions?.searchTokenString) {\n            queryParams[Param.searchTokenString] = encodeURIComponent(\n                searchOptions.searchTokenString,\n            );\n\n            if (searchOptions.executeSearch) {\n                queryParams[Param.executeSearch] = true;\n            }\n        }\n        if (enableSearchAssist) {\n            queryParams[Param.EnableSearchAssist] = true;\n        }\n        if (hideResults) {\n            queryParams[Param.HideResult] = true;\n        }\n        if (forceTable) {\n            queryParams[Param.ForceTable] = true;\n        }\n\n        queryParams[Param.DataSourceMode] = this.getDataSourceMode();\n        queryParams[Param.UseLastSelectedDataSource] = false;\n        let query = '';\n        const queryParamsString = getQueryParamString(queryParams, true);\n        if (queryParamsString) {\n            query = `?${queryParamsString}`;\n        }\n\n        return `${this.getEmbedBasePath(query)}/${answerPath}`;\n    }\n\n    /**\n     * Render the embedded ThoughtSpot search\n     */\n    public render(): SearchEmbed {\n        super.render();\n        const { answerId, dataSources } = this.viewConfig;\n\n        const src = this.getIFrameSrc(answerId, dataSources);\n        this.renderIFrame(src, this.viewConfig.frameParams);\n        return this;\n    }\n}\n"]},"metadata":{},"sourceType":"module"}